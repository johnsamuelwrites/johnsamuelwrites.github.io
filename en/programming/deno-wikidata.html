<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="utf-8" />
        <meta http-equiv="Content-Language" content="en" />
        <link rel="shortcut icon" href="../../images/logo/favicon.png" />
        <title>When Deno meets Wikidata: John Samuel</title>
        <style type="text/css">
            body {
                background-color: #FFFFFF;
            }

            #sidebar {
                position: fixed;
                background-color: #009AA6;
                top: 0;
                left: 0;
                bottom: 0;
                width: 30vw;
            }

            #sidebar .title {
                position: relative;
                text-align: center;
                line-height: 5vmax;
                font-size: 1.4vmax;
                font-family: 'Arial';
                margin-top: 30vh;
            }

            #sidebar .title a:link,
            #sidebar .title a:visited {
                color: #FFFFFF;
                text-decoration: none;
            }

            .subtitle {
                top: 50vh;
                text-align: center;
                line-height: 1.3vmax;
                font-family: 'Arial';
                font-size: 1.2vmax;
                color: #FFFFFF;
            }

            .subtitle a:link,
            .subtitle a:visited {
                color: #FFFFFF;
                text-decoration: none;
            }

            .licence {
                position: fixed;
                text-align: right;
                bottom: 0;
                right: 0;
            }

            .home {
                position: fixed;
                text-align: left;
                font-family: 'Arial';
                color: #D3D3D3;
                z-index: 100;
                width: 100%;
                background-color: #FFFFFF;
                top: 0px;
                margin-bottom: 10px;
                padding-bottom: 10px;
            }

            pre {
                background-color: #eeeeee;
                overflow: auto;
            }

            .home a:link,
            .home a:visited {
                text-decoration: none;
                color: #D3D3D3;
            }

            .home ul {
                margin: 0;
                padding: 0;
                text-align: left;
                list-style: none;
            }

            .home li {
                position: relative;
                float: left;
                padding-top: 15px;
                margin-right: 1em;
                font-family: 'Arial';
            }

            .home li:hover {
                display: block;
            }

            .home li:hover a:link,
            .home li:hover a:visited {
                text-decoration: none;
                padding: 15px;
                color: #FFFFFF;
                background-color: #009AA6;
            }

            .content {
                line-height: 1.8vmax;
                font-size: 1.2vmax;
                font-family: 'Arial';
                margin-top: 15vh;
                width: 90%;
            }

            .content h1,
            h2,
            h3,
            h4 {
                color: #009AA6;
            }

            .content a:link,
            .content a:visited {
                color: #009AA6;
            }

            .content h3 {
                color: #009AA6;
            }

            .content h2::before,
            .content h3::before {
                display: block;
                content: " ";
                visibility: hidden;
                height: 50px;
                margin-top: -50px;
                pointer-events: none;
                background-color: #FFFFFF;
            }

            .content a:link,
            .content a:visited {
                color: #009AA6;
            }

            .home a:link,
            .home a:visited {
                color: #D3D3D3;
            }

            .content li {
                line-height: 1vmax;
            }

            .page {
                width: 65vw;
                height: 100%;
                margin-left: 30vw;
                overflow: hidden;
                padding: 0 1em;
                font-family: 'Arial';
            }

            .page img {
                max-width: 100%;
                max-height: 100%;
            }

            @media (max-width: 640px),
            screen and (orientation: portrait) {
                body {
                    max-width: 100%;
                    max-height: 100%;
                }

                #sidebar {
                    position: fixed;
                    background-color: #009AA6;
                    top: 0;
                    left: 0;
                    bottom: 80vh;
                    width: 100vw;
                }

                #sidebar .title {
                    text-align: center;
                    position: fixed;
                    margin-top: 6vh;
                    left: 0px;
                    right: 0px;
                    line-height: 3.5vmax;
                    font-size: 1.5vmax;
                    font-family: 'Arial';
                }

                #sidebar .subtitle {
                    text-align: center;
                    top: 5vh;
                    left: 0px;
                    right: 0px;
                    position: fixed;
                    margin-top: 10vh;
                    font-size: 1.5vmax;
                }

                #sidebar .title a:link,
                #sidebar .title a:visited {
                    text-align: center;
                    color: #FFFFFF;
                }

                #sidebar .subtitle a:link,
                #sidebar .subtitle a:visited {
                    text-align: center;
                    color: #FFFFFF;
                }

                .home {
                    z-index: 100;
                    width: 100%;
                    background-color: #009AA6;
                    font-size: 1.5vmax;
                }

                .home a:link,
                .home a:visited {
                    text-decoration: none;
                    color: #FFFFFF;
                }

                .content {
                    line-height: 3.8vmax;
                    font-size: 1.8vmax;
                    font-family: 'Arial';
                    margin-top: 22vh;
                }

                .content a:link,
                .content a:visited {
                    color: #009AA6;
                }

                .page {
                    top: 40vh;
                    width: 95%;
                    margin-left: 0vw;
                }

                .page img {
                    max-width: 100%;
                    max-height: 100%;
                    border: 0;
                }
            }
        </style>
        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "BlogPosting",
            "mainEntityOfPage": {
                "@type": "WebPage",
                "@id": "https://johnsamuel.info"
            },
            "articleSection": "blog",
            "name": "When Deno meets Wikidata",
            "headline": "When Deno meets Wikidata",
            "description": "Article by John Samuel",
            "inLanguage": "en",
            "author": "John Samuel",
            "datePublished": "2020-06-20 19:03:57",
            "dateModified": "2020-06-20 19:25:09",
            "dateCreated": "2020-06-20 19:03:57",
            "url": "https://johnsamuel.info/en/programming/deno-wikidata.html",
            "image": {
                "@type": "imageObject",
                "url": "https://johnsamuel.info/images/writings/coconut-trees-landscape.svg",
                "height": "600",
                "width": "800"
            },
            "publisher": {
                "@type": "Organization",
                "name": "John Samuel",
                "logo": {
                    "@type": "imageObject",
                    "url": "https://johnsamuel.info/images/writings/coconut-trees-landscape.svg"
                }
            },
            "keywords": ["Blog"]
        }
    </script>
    </head>

    <body vocab="http://schema.org/">
        <div id="sidebar">
            <div class="title">
                <h1><a href="./deno-wikidata.html">When Deno meets Wikidata</a></h1>
            </div>
            <div class="subtitle">
                <h3><a href="../about.html">John Samuel</a></h3>
            </div>
        </div>
        <div class="page">
            <div class="home">
                <ul typeof="BreadcrumbList">
                    <li property="itemListElement" typeof="ListItem">
                        <a property="item" typeof="WebPage" href="../index.html">
                            <span property="name">Home</span>
                        </a>
                    </li>
                    <li property="itemListElement" typeof="ListItem">
                        <a property="item" typeof="WebPage" href="../programming/index.html">
                            <span property="name">Programming</span>
                        </a>
                    </li>
                    <li property="itemListElement" typeof="ListItem">
                        <a property="item" typeof="WebPage" href="../research/research.html">
                            <span property="name">Research</span>
                        </a>
                    </li>
                </ul>
            </div>
            <div class="content">
                <p>Recently Deno 1.0<sup><a href="#denov1">1</a></sup> was released. I have been experimenting with
                    Javascript and Node.js for quite a while. However, my experiments with Typescript were very limited.
                    Deno provides a secure runtime for both Javascript
                    and Typescript. This article is related to my experiments with Deno and Typescript for accessing
                    Wikidata. If you have been following some of my past works like WDProp<sup><a
                            href="#wdprop">2</a></sup> or WikiProvenance<sup><a href="#wikiprovenance">3</a></sup>,
                    you may have observed that both of these works were developed in vanilla Javascript without any
                    Node.js<sup><a href="#nodejs">4</a></sup> module. However, given the static typing of Typescript, I
                    want to explore it with Deno for accessing
                    Wikidata. And the preliminary development experience went well.</p>
                <h3>Deno</h3>
                <p>Installing Deno<sup><a href="#installation">5</a></sup> was easy and it could be installed locally in
                    the user environment.</p>
                <code>
	  <pre>
  $ curl -fsSL https://deno.land/x/install/install.sh | sh
  ######################################################################## 100,0%##O#- #                                       ######################################################################## 100,0%
  Archive:  /home/john/.deno/bin/deno.zip
     inflating: deno
  Deno was installed successfully to /home/john/.deno/bin/deno
	  </pre>
	</code>
                <p>After manually adding the <code>deno</code> directory to my <code>$HOME/.bashrc</code>, I could start
                    working with it.</p>
                <code>
	  <pre>
     export DENO_INSTALL="/home/john/.deno"
     export PATH="$DENO_INSTALL/bin:$PATH"
	  </pre>
	</code>
                <p>To ensure that my changes are taken into consideration, I ran</p>
                <code>
	  <pre>
     $ source $HOME/.bashrc
	  </pre>
	</code>
                <p>At the time of writing, I have the following version of Deno installed.</p>
                <code>
	  <pre>
     $ deno --version
      deno 1.1.0
      v8 8.4.300
      typescript 3.9.2
	  </pre>
	</code>
                <p>My first <code>Hello World</code> program was written in the file <code>hello.ts</code></p>
                <code>
	  <pre>
      console.log("Hello World!")
	  </pre>
	</code>
                <p>Executing it required the <code>run</code> option and I could see that the file was compiled and the
                    output can be seen on the terminal.</p>
                <code>
	  <pre>
     $ deno run hello.ts 
      Compile file:///home/john/deno/hello.ts
      Hello World! 
	  </pre>
	</code>
                <p>Thus I am all set for running my Typescript programs with <code>deno</code>.</p>
                <h3>Wikidata</h3>
                <p>My next goal was to make use of simple SPARQL queries and get data from the Wikidata SPARQL
                    endpoint<sup><a href="#wikidata">6</a></sup>. For example, the following SPARQL queries would give
                    me 10 human from Wikidata.</p>
                <code>
	  <pre>
	  SELECT ?item {
	    ?item wdt:P31 wd:Q5
	  }
	  LIMIT 10
	  </pre>
	</code>
                <h3>Deno and Wikidata</h3>
                <p>Making use of Wikidata SPARQL endpoint, I first wrote the following code <code>fetch.ts</code>.</p>
                <pre>
	<code>
   const result = await fetch("https://query.wikidata.org/sparql?query=SELECT%20%3Fitem%20%7B%0A%20%20%3Fitem%20wdt%3AP31%20wd%3AQ5%0A%7D%0ALIMIT%2010&format=json");
   const data = await result.json();
   console.log(data.results)
	</code>
	  </pre>
                <p>Continuing with the same style of execution as shown above, a simple <code>deno run</code> however
                    gave the following errors:</p>
                <code>
	  <pre>
     $ deno run fetch.ts
     Compile file:///home/john/deno/fetch.ts
     error: Uncaught PermissionDenied: network access to "https://query.wikidata.org/sparql?query=SELECT%20%3Fitem%20%7B%0A%20%20%3Fitem%20wdt%3AP31%20wd%3AQ5%0A%7D%0ALIMIT%2010&format=jsn", run again with the --allow-net flag
        at unwrapResponse ($deno$/ops/dispatch_json.ts:43:11)
        at Object.sendAsync ($deno$/ops/dispatch_json.ts:98:10)
        at async fetch ($deno$/web/fetch.ts:265:27)
        at async file:///home/john/contributions/deno/fetch.ts:1:16
	  </pre>
	</code>
                <p>This is the interesting part of <code>deno</code>. Unlike node, deno requires permissions from the
                    user to connect with the internet. Hence the option <code>--allow-net</code> need to be used with
                    <code>deno run</code> for running the above
                    file.
                </p>
                <code>
	  <pre>
     $ deno run --allow-net fetch.ts 
      {
        bindings: [
          { item: { type: "uri", value: "http://www.wikidata.org/entity/Q23" } },
          { item: { type: "uri", value: "http://www.wikidata.org/entity/Q42" } },
          { item: { type: "uri", value: "http://www.wikidata.org/entity/Q76" } },
          { item: { type: "uri", value: "http://www.wikidata.org/entity/Q80" } },
          { item: { type: "uri", value: "http://www.wikidata.org/entity/Q91" } },
          { item: { type: "uri", value: "http://www.wikidata.org/entity/Q157" } },
          { item: { type: "uri", value: "http://www.wikidata.org/entity/Q181" } },
          { item: { type: "uri", value: "http://www.wikidata.org/entity/Q185" } },
          { item: { type: "uri", value: "http://www.wikidata.org/entity/Q186" } },
          { item: { type: "uri", value: "http://www.wikidata.org/entity/Q192" } }
        ]
      }
	  </pre>
	</code>
                <p>The next goal is to make use of functions and split the logic of calling Wikidata and printing
                    results separately. First, a function in the file <code>wdqs.ts</code> is created to query Wikidata
                    and handle proper response or an error. Note
                    that the function has been declared as asynchronous and it is also declared to be exported, i.e., it
                    can be used in other Typescript files. </p>
                <code>
	  <pre>
  export async function query_wikidata(query: string){
    let queryresults:object = [];
    await fetch(query)
    .then(response => {
      if (!response.ok) {
        throw new Error("Problem in obtaining a response");
      }
      return response.json();
    })
    .then(results => {
      queryresults = results.results.bindings;
    })
    .catch(error => {
      console.error('Error in calling Wikidata API', error);
    });
    return (queryresults);
  }

	  </pre>
	</code>
                <p>Now, this function is imported in another file <code>query.ts</code>. The first line imports the
                    function <code>query_wikidata()</code>. In this file, the URL of SPARQL endpoint is passed as an
                    input. And once the result is obtained, the Wikidata
                    identifiers of different humans are obtained.</p>
                <code>
	  <pre>
  import {query_wikidata} from "./wdqs.ts"
  
  let promise = query_wikidata("https://query.wikidata.org/sparql?query=SELECT%20%3Fitem%20%7B%0A%20%20%3Fitem%20wdt%3AP31%20wd%3AQ5%0A%7D%0ALIMIT%2010&format=json")
  promise.then(
     (result: any) => {
       for (let row of result) {
         console.log(row.item.value)
       }
     });
	  </pre>
	</code>
                <p>Finally, the new file <code>query.ts</code> is run using <code>deno</code>.</p>
                <code>
	  <pre>
  $ deno run --allow-net query.ts 
  Compile file:///home/john/deno/query.ts
  http://www.wikidata.org/entity/Q23
  http://www.wikidata.org/entity/Q42
  http://www.wikidata.org/entity/Q76
  http://www.wikidata.org/entity/Q80
  http://www.wikidata.org/entity/Q91
  http://www.wikidata.org/entity/Q157
  http://www.wikidata.org/entity/Q181
  http://www.wikidata.org/entity/Q185
  http://www.wikidata.org/entity/Q186
  http://www.wikidata.org/entity/Q192
	  </pre>
	</code>
                <p>I like how <code>deno</code> asks permissions from the user before running the scripts. There are
                    flags like <code>--allow-read</code> or <code>--allow-net</code> that ensures <code>deno</code> does
                    not access the local filesystem and the
                    local environment respectively without these flags. The current way of importing functions using
                    URLs (not discussed here) is very interesting. I would like to further explore Typescript and Deno
                    for future Wikidata related projects.</p>
                <h3>References</h3>
                <ol>
                    <li id="#denov1"><a href="https://deno.land/v1">Deno 1.0</a></li>
                    <li id="#wdprop"><a href="https://github.com/johnsamuelwrites/wdprop">WDProp</a></li>
                    <li id="#wikiprovenance"><a
                            href="https://github.com/johnsamuelwrites/WikiProvenance">WikiProvenance</a></li>
                    <li id="#nodejs"><a href="https://nodejs.org/en/">Node.js</a></li>
                    <li id="#installation"><a href="https://deno.land/">Deno</a></li>
                    <li id="#wikidata"><a href="https://query.wikidata.org/">Wikidata Query Service</a></li>
                </ol>
            </div>
        </div>
    </body>

</html>